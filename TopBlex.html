<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FashionHub - Tienda de Ropa</title>
  <style>
    /* Reset y estilos base */
    :root{
      --bg:#f6f6f8; --card:#ffffff; --accent:#111827; --muted:#6b7280; --accent-2:#0ea5a4;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;background:var(--bg);color:#111}
    a{color:inherit;text-decoration:none}
    header{background:var(--card);padding:16px 20px;box-shadow:0 1px 4px rgba(0,0,0,.05);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:40;}
    .brand{font-weight:700;font-size:18px;cursor:pointer}
    nav{display:flex;gap:8px;align-items:center}
    button{cursor:pointer}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:6px;border:none}
    .btn-ghost{background:transparent;border:1px solid #e6e6e9;padding:8px 12px;border-radius:6px}
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    .grid{display:grid;gap:16px}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 1px 3px rgba(12,12,12,.04)}
    .flex{display:flex;gap:12px;align-items:center}
    .muted{color:var(--muted);font-size:14px}
    img.product{width:100%;height:260px;object-fit:cover;border-radius:8px;background:linear-gradient(90deg,#eee,#ddd)}
    .cols-3{grid-template-columns:repeat(3,1fr)}
    .cols-2{grid-template-columns:repeat(2,1fr)}
    @media (max-width:900px){ .cols-3{grid-template-columns:repeat(2,1fr)} .product{height:220px} }
    @media (max-width:600px){ .cols-3{grid-template-columns:1fr} header{padding:12px} nav .hide-sm{display:none} .flex{flex-direction:column;align-items:flex-start} }
    /* Modal / overlay */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;z-index:80}
    .modal{width:100%;max-width:920px;background:var(--card);padding:20px;border-radius:10px}
    .small{font-size:13px;color:var(--muted)}
    /* product card */
    .product-footer{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .tag-sale{background:#fde68a;color:#92400e;padding:4px 8px;border-radius:999px;font-size:12px}
    .category-tabs{display:flex;gap:8px;flex-wrap:wrap}
    .pill{padding:6px 10px;background:#f3f4f6;border-radius:999px;border:1px solid #e7e7ea;font-size:14px}
    .cart-item{display:flex;gap:12px;align-items:center;padding:10px;border-radius:8px;background:#fff}
    input[type=number]{padding:6px;border-radius:6px;border:1px solid #e6e6e9;width:72px}
    input,select,textarea{padding:8px;border-radius:6px;border:1px solid #e6e6e9;width:100%}
    footer{margin-top:30px;padding:30px 0;text-align:center;color:var(--muted);font-size:13px}
    .info-box{background:#fff;padding:12px;border-radius:8px}
  </style>
</head>
<body>
  <header>
    <div class="brand" onclick="go('home')">FashionHub</div>
    <nav>
      <button class="btn-ghost hide-sm" onclick="go('home')">Inicio</button>
      <button class="btn-ghost hide-sm" onclick="go('catalog')">Catálogo</button>
      <button class="btn-ghost hide-sm" onclick="go('help')">Ayuda</button>
      <button class="btn-ghost hide-sm" onclick="go('about')">Empresa</button>
      <button id="btn-favs" class="btn-ghost" onclick="go('favorites')">Favoritos (<span id="count-favs">0</span>)</button>
      <button id="btn-cart" class="btn" onclick="go('cart')">Carrito (<span id="count-cart">0</span>)</button>
    </nav>
  </header>

  <main class="container" id="app">
    <!-- VISTAS se inyectan aquí -->
  </main>

  <footer>&copy; <span id="year"></span> FashionHub — Tienda local · Sostenibilidad · Novedades</footer>

  <!-- OVERLAY / WELCOME (contraseña) -->
  <div id="welcome-overlay" class="overlay" style="display:none">
    <div class="modal" style="max-width:420px">
      <h2>Bienvenido a FashionHub</h2>
      <p class="small">Introduce la contraseña para acceder a la tienda.</p>
      <form id="pwdForm" style="margin-top:12px">
        <input id="pwdInput" placeholder="Contraseña" type="password" autocomplete="off" />
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end">
          <button type="button" class="btn-ghost" onclick="document.getElementById('pwdInput').value=''">Limpiar</button>
          <button class="btn" onclick="event.preventDefault(); tryAccess()">Entrar</button>
        </div>
        <p class="small" style="margin-top:10px">Consejo: la contraseña requerida es <strong>topblex</strong>.</p>
        <p id="pwd-error" class="small" style="color:#b91c1c;display:none;margin-top:6px">Contraseña incorrecta</p>
      </form>
    </div>
  </div>

  <!-- PRODUCT DETAIL MODAL -->
  <div id="product-modal-place"></div>

  <script>
    // ===== Datos de ejemplo (puedes personalizar productos aquí) =====
    const PRODUCTS = [
      { id:'m-jeans-01', name:'Jeans Slim Fit', category:'Hombre', sub:'Parte inferiores', price:49.99, colors:['Azul','Negro'], sizes:['S','M','L','XL'], img:placeholder('Jeans'), sale:false },
      { id:'m-cap-01', name:'Gorra Trucker', category:'Hombre', sub:'Gorras', price:19.99, colors:['Negra','Beige'], sizes:['One Size'], img:placeholder('Gorra'), sale:true },
      { id:'m-bag-01', name:'Bolsa Crossbody', category:'Hombre', sub:'Bolsas', price:29.99, colors:['Caqui','Negro'], sizes:['One Size'], img:placeholder('Bolsa'), sale:false },
      { id:'w-dress-01', name:'Vestido Floral', category:'Mujer', sub:'Parte inferiores', price:59.99, colors:['Rojo','Azul'], sizes:['XS','S','M','L'], img:placeholder('Vestido'), sale:false },
      { id:'w-bag-01', name:'Bolso Tote', category:'Mujer', sub:'Bolsas', price:29.99, colors:['Negro','Marrón'], sizes:['One Size'], img:placeholder('Bolso'), sale:true },
      { id:'w-hat-01', name:'Gorra Canvas', category:'Mujer', sub:'Gorras', price:17.5, colors:['Rosa','Negro'], sizes:['One Size'], img:placeholder('Gorra'), sale:false },
      { id:'acc-scarf-01', name:'Bufanda Oversize', category:'Unisex', sub:'Accesorios', price:15.00, colors:['Gris','Beige'], sizes:['One Size'], img:placeholder('Bufanda'), sale:false }
    ];

    // ===== Helpers =====
    function $(s){return document.querySelector(s)}
    function $all(s){return document.querySelectorAll(s)}
    function placeholder(text){
      // simple SVG data URL as placeholder image (works offline)
      const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='800'><rect width='100%' height='100%' fill='#efefef'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#999' font-family='Arial, sans-serif'>${text}</text></svg>`;
      return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
    }

    // ===== Local storage keys =====
    const KEY_CART = 'fh_cart_v1';
    const KEY_FAVS = 'fh_favs_v1';
    const KEY_ACCESS = 'fh_access_v1';

    // ===== State =====
    let CART = JSON.parse(localStorage.getItem(KEY_CART) || '[]');
    let FAVS = JSON.parse(localStorage.getItem(KEY_FAVS) || '[]');
    const sessionAccess = sessionStorage.getItem(KEY_ACCESS) === 'granted';

    // ===== Inicial =====
    document.getElementById('year').innerText = new Date().getFullYear();
    renderCounts();
    // show welcome overlay if no session access
    if(!sessionAccess){
      $('#welcome-overlay').style.display = 'flex';
    } else {
      go('home');
    }

    // ===== Funciones de navegación SPA simple (hashless) =====
    function go(view){
      // clear modals
      $('#product-modal-place').innerHTML = '';
      // switch views
      if(!sessionStorage.getItem(KEY_ACCESS) && view !== 'welcome' && $('#welcome-overlay').style.display !== 'flex'){
        // ensure session
        $('#welcome-overlay').style.display = 'flex';
        return;
      }
      if(view === 'home'){ renderHome(); }
      else if(view === 'catalog'){ renderCatalog(); }
      else if(view === 'cart'){ renderCart(); }
      else if(view === 'checkout'){ renderCheckout(); }
      else if(view === 'help'){ renderHelp(); }
      else if(view === 'about'){ renderAbout(); }
      else if(view === 'favorites'){ renderFavorites(); }
      else renderHome();
      window.scrollTo(0,0);
    }

    // ===== Welcome (contraseña) =====
    function tryAccess(){
      const val = $('#pwdInput').value.trim();
      if(val === 'topblex'){
        sessionStorage.setItem(KEY_ACCESS,'granted');
        $('#welcome-overlay').style.display = 'none';
        go('home');
        $('#pwd-error').style.display = 'none';
      } else {
        $('#pwd-error').style.display = 'block';
      }
    }

    // ===== Render Home =====
    function renderHome(){
      const html = `
        <section class="grid" style="grid-template-columns:1fr;gap:16px">
          <div class="card flex" style="align-items:center;gap:16px">
            <div style="flex:1">
              <h1 style="margin:0;font-size:28px">Bienvenido a FashionHub</h1>
              <p class="muted" style="margin-top:8px">Tienda local - sostenibilidad - novedades. Descubre colecciones y compra con facilidad.</p>
              <div style="margin-top:12px;display:flex;gap:8px">
                <button class="btn" onclick="go('catalog')">Ir al catálogo</button>
                <button class="btn-ghost" onclick="go('about')">Empresa</button>
              </div>
            </div>
            <div style="width:320px">
              <img src="${placeholder('Banner')}" alt="banner" style="width:100%;border-radius:8px" />
            </div>
          </div>

          <div class="grid cols-3">
            <div class="card info-box">
              <h3 style="margin:0 0 8px 0">Novedades</h3>
              <p class="small">Lanzamientos, colecciones y promociones. Aquí podrás anunciar nuevas prendas y colaboraciones.</p>
            </div>
            <div class="card info-box">
              <h3 style="margin:0 0 8px 0">Sostenibilidad</h3>
              <p class="small">Información sobre materiales reciclados, procesos responsables y compromisos ambientales de la marca.</p>
            </div>
            <div class="card info-box">
              <h3 style="margin:0 0 8px 0">Atención</h3>
              <p class="small">Desde Ayuda puedes consultar el estado de tu envío, devoluciones y opciones de pago.</p>
            </div>
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
    }

    // ===== Render Catalog =====
    function renderCatalog(){
      // build category filters
      const cats = ['Todo','Hombre','Mujer','Oferta'];
      const subcats = ['Todas','Parte inferiores','Gorras','Bolsas','Accesorios'];

      const html = `
        <section>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <h2 style="margin:0">Catálogo</h2>
              <p class="small" style="margin:6px 0 0 0">Filtra por categoría o subcategoría para encontrar productos.</p>
            </div>
            <div class="category-tabs">
              ${cats.map(c=>`<button class="pill" onclick="filterCatalog('${c}')">${c}</button>`).join('')}
            </div>
          </div>

          <div class="card" style="margin-bottom:12px">
            <strong>Subcategorías:</strong>
            <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
              ${subcats.map(s=>`<button class="pill" onclick="filterSub('${s}')">${s}</button>`).join('')}
            </div>
          </div>

          <div id="catalog-grid" class="grid cols-3">
            ${renderProductCards(PRODUCTS)}
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
      // store current filters
      window._catalogFilter = {cat:'Todo', sub:'Todas'};
    }

    function renderProductCards(list){
      return list.map(p => `
        <div class="card">
          <img class="product" src="${p.img}" alt="${escapeHtml(p.name)}" />
          <div style="margin-top:8px">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <strong>${escapeHtml(p.name)}</strong>
                <div class="muted" style="margin-top:4px">${p.sub} • ${p.category}</div>
              </div>
              ${p.sale?'<div class="tag-sale">Oferta</div>':''}
            </div>
            <div class="product-footer">
              <div><strong>€${p.price.toFixed(2)}</strong></div>
              <div style="display:flex;gap:8px">
                <button class="btn-ghost" onclick="viewProduct('${p.id}')">Ver</button>
                <button class="btn" onclick="addFavoriteById('${p.id}')" title="Añadir a favoritos">❤</button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function filterCatalog(cat){
      window._catalogFilter.cat = cat;
      applyCatalogFilters();
    }
    function filterSub(sub){
      window._catalogFilter.sub = sub;
      applyCatalogFilters();
    }
    function applyCatalogFilters(){
      const f = window._catalogFilter || {cat:'Todo', sub:'Todas'};
      let list = PRODUCTS.slice();
      if(f.cat === 'Hombre') list = list.filter(p => p.category === 'Hombre');
      else if(f.cat === 'Mujer') list = list.filter(p => p.category === 'Mujer');
      else if(f.cat === 'Oferta') list = list.filter(p => p.sale === true);
      if(f.sub && f.sub !== 'Todas') list = list.filter(p => p.sub === f.sub);
      $('#catalog-grid').innerHTML = renderProductCards(list);
    }

    // ===== Product Detail Modal =====
    function viewProduct(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const html = `
        <div class="overlay" id="prod-overlay">
          <div class="modal" style="max-width:900px">
            <div style="display:flex;gap:18px">
              <div style="flex:1">
                <img src="${p.img}" alt="${escapeHtml(p.name)}" style="width:100%;height:420px;object-fit:cover;border-radius:8px" />
              </div>
              <div style="width:380px">
                <h2 style="margin:0">${escapeHtml(p.name)}</h2>
                <div class="muted" style="margin-top:6px">${p.category} • ${p.sub}</div>
                <div style="margin-top:8px"><strong>€${p.price.toFixed(2)}</strong></div>

                <div style="margin-top:12px">
                  <label class="small">Talla</label>
                  <select id="sel-size">${p.sizes.map(s=>`<option value="${s}">${s}</option>`).join('')}</select>
                </div>

                <div style="margin-top:12px">
                  <label class="small">Color</label>
                  <select id="sel-color">${p.colors.map(c=>`<option value="${c}">${c}</option>`).join('')}</select>
                </div>

                <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
                  <label class="small" style="margin:0">Cantidad</label>
                  <input id="sel-qty" type="number" min="1" value="1" style="width:80px" />
                </div>

                <div style="margin-top:16px;display:flex;gap:8px">
                  <button class="btn" onclick="buyNow('${id}')">Comprar ahora</button>
                  <button class="btn-ghost" onclick="addToCartById('${id}')">Añadir al carrito</button>
                  <button class="btn-ghost" onclick="closeProductModal()">Cerrar</button>
                </div>

                <p class="small" style="margin-top:12px">Nota: en el checkout solo estará disponible la opción de pago a través de Shopify (simulación). Cuando integres tu tienda Shopify, podrás redirigir al checkout real.</p>
              </div>
            </div>
          </div>
        </div>
      `;
      $('#product-modal-place').innerHTML = html;
      // attach close handler to overlay
      document.getElementById('prod-overlay').addEventListener('click', (e)=>{
        if(e.target.id === 'prod-overlay') closeProductModal();
      });
    }
    function closeProductModal(){ $('#product-modal-place').innerHTML = '' }

    // ===== Cart and Favorites operations =====
    function addToCartById(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const size = $('#sel-size') ? $('#sel-size').value : p.sizes[0];
      const color = $('#sel-color') ? $('#sel-color').value : p.colors[0];
      const qty = $('#sel-qty') ? Math.max(1, parseInt($('#sel-qty').value||1)) : 1;
      CART.push({ id:p.id, name:p.name, price:p.price, chosenSize:size, chosenColor:color, qty:qty, img:p.img });
      persistCart();
      renderCounts();
      alert('Artículo añadido al carrito');
    }
    function addFavoriteById(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      if(!FAVS.find(f=>f.id===p.id)){
        FAVS.push({id:p.id,name:p.name,price:p.price,img:p.img});
        persistFavs();
        renderCounts();
        alert('Añadido a favoritos');
      } else {
        alert('Ya está en favoritos');
      }
    }

    function persistCart(){ localStorage.setItem(KEY_CART, JSON.stringify(CART)); }
    function persistFavs(){ localStorage.setItem(KEY_FAVS, JSON.stringify(FAVS)); }

    function renderCounts(){
      $('#count-cart').innerText = CART.length;
      $('#count-favs').innerText = FAVS.length;
      // update header cart count
      $all('#btn-cart, #btn-favs').forEach(()=>{});
    }

    // ===== Buy now -> Checkout flow (replace cart with single item then go to checkout) =====
    function buyNow(id){
      const p = PRODUCTS.find(x=>x.id===id);
      if(!p) return;
      const size = $('#sel-size') ? $('#sel-size').value : p.sizes[0];
      const color = $('#sel-color') ? $('#sel-color').value : p.colors[0];
      const qty = $('#sel-qty') ? Math.max(1, parseInt($('#sel-qty').value||1)) : 1;
      // set cart to only this item
      CART = [{ id:p.id, name:p.name, price:p.price, chosenSize:size, chosenColor:color, qty:qty, img:p.img }];
      persistCart();
      renderCounts();
      closeProductModal();
      go('checkout');
    }

    // ===== Render Cart View =====
    function renderCart(){
      let subtotal = CART.reduce((s,i)=>s + i.price * i.qty, 0);
      const itemsHtml = CART.length === 0 ? '<p>Tu carrito está vacío.</p>' : CART.map((it, idx) => `
        <div class="cart-item" style="justify-content:space-between">
          <div style="display:flex;gap:12px;align-items:center">
            <img src="${it.img}" alt="${escapeHtml(it.name)}" style="width:84px;height:84px;object-fit:cover;border-radius:6px" />
            <div>
              <div style="font-weight:600">${escapeHtml(it.name)}</div>
              <div class="muted">Color: ${escapeHtml(it.chosenColor)} • Talla: ${escapeHtml(it.chosenSize)}</div>
            </div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="number" value="${it.qty}" min="1" onchange="updateQty(${idx}, this.value)" />
            <div style="min-width:90px;text-align:right;font-weight:700">€${(it.price * it.qty).toFixed(2)}</div>
            <button class="btn-ghost" onclick="removeFromCart(${idx})">Eliminar</button>
          </div>
        </div>
      `).join('');

      const html = `
        <section>
          <h2>Carrito</h2>
          <div style="margin-top:12px" class="grid" >
            <div class="card">${itemsHtml}</div>
            ${CART.length>0 ? `
            <div class="card" style="display:flex;flex-direction:column;gap:12px">
              <div style="display:flex;justify-content:space-between"><div>Subtotal parcial</div><div><strong>€${subtotal.toFixed(2)}</strong></div></div>
              <div class="small">El importe mostrado es parcial. Costes de envío e impuestos se calcularán en el checkout.</div>
              <button class="btn" onclick="go('checkout')">Continuar a pagar con Shopify</button>
              <div class="small" style="margin-top:6px;color:#6b7280">Al pulsar se simula la redirección a la pasarela de Shopify. Integra tu tienda Shopify para el pago real.</div>
            </div>` : ''}
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
    }

    function updateQty(index, newVal){
      const n = Math.max(1, parseInt(newVal || 1));
      CART[index].qty = n;
      persistCart();
      renderCart();
      renderCounts();
    }
    function removeFromCart(index){
      if(confirm('¿Eliminar este producto del carrito?')){
        CART.splice(index,1);
        persistCart();
        renderCart();
        renderCounts();
      }
    }

    // ===== Render Checkout =====
    function renderCheckout(){
      if(CART.length === 0){
        // if cart empty, show message
        $('#app').innerHTML = `<section><h2>Checkout</h2><div class="card"><p>Tu carrito está vacío. Puedes comprar desde el catálogo.</p><div style="margin-top:8px"><button class="btn" onclick="go('catalog')">Ir al catálogo</button></div></div></section>`;
        return;
      }
      const subtotal = CART.reduce((s,i)=>s + i.price * i.qty, 0);
      const itemsHtml = CART.map(it => `
        <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
          <img src="${it.img}" style="width:72px;height:72px;object-fit:cover;border-radius:6px" />
          <div style="flex:1">
            <div style="font-weight:600">${escapeHtml(it.name)}</div>
            <div class="muted">Talla: ${escapeHtml(it.chosenSize)} • Color: ${escapeHtml(it.chosenColor)}</div>
            <div class="small">Cantidad: ${it.qty}</div>
          </div>
          <div style="font-weight:700">€${(it.price * it.qty).toFixed(2)}</div>
        </div>
      `).join('');

      const html = `
        <section>
          <h2>Checkout</h2>
          <div style="display:grid;grid-template-columns:1fr 420px;gap:16px;margin-top:12px">
            <div class="card">
              <h3 style="margin-top:0">Detalles de contacto y entrega</h3>
              <form id="checkout-form" onsubmit="event.preventDefault(); processPayment()">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                  <input name="email" placeholder="Correo electrónico" required />
                  <input name="country" placeholder="País / Región" required />
                </div>
                <div style="margin-top:8px">
                  <input name="name" placeholder="Nombre completo" required />
                </div>
                <div style="margin-top:8px">
                  <input name="address" placeholder="Dirección" required />
                </div>
                <div style="margin-top:8px;display:grid;grid-template-columns:1fr 1fr;gap:8px">
                  <input name="apt" placeholder="Apartamento / Piso (opcional)" />
                  <input name="city" placeholder="Ciudad" required />
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
                  <input name="postal" placeholder="Código postal" required />
                  <input name="phone" placeholder="Teléfono" required />
                </div>

                <div style="margin-top:12px">
                  <div class="small">Método de pago: Únicamente disponible via <strong>Shopify</strong> (simulación en esta demo).</div>
                </div>

                <div style="margin-top:12px">
                  <button class="btn" type="submit">Pagar ahora (Shopify)</button>
                </div>
              </form>
            </div>

            <div class="card">
              <h3 style="margin-top:0">Resumen del pedido</h3>
              <div style="margin-top:8px">${itemsHtml}</div>
              <div style="border-top:1px dashed #eee;padding-top:10px;margin-top:10px;display:flex;justify-content:space-between;font-weight:700">
                <div>Total</div><div>€${subtotal.toFixed(2)}</div>
              </div>
              <div class="small" style="margin-top:10px">Asegúrate de que los datos de entrega sean correctos antes de proceder al pago.</div>
            </div>
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
      // optionally prefill checkout with last used contact (not implemented)
    }

    // ===== Process Payment (simulate Shopify) =====
    function processPayment(){
      const form = document.getElementById('checkout-form');
      // validate minimal
      const data = new FormData(form);
      const email = data.get('email');
      if(!email){ alert('Completa el correo electrónico'); return; }
      // simulate redirect to Shopify
      alert('Redirigiendo a Shopify... (simulación) \nEn la versión final debes integrar el checkout de Shopify para pagos reales.');
      // clear cart and persist
      CART = [];
      persistCart();
      renderCounts();
      go('home');
      alert('Pedido completado (simulación). Gracias por tu compra.');
    }

    // ===== Help =====
    function renderHelp(){
      const html = `
        <section>
          <h2>Ayuda</h2>
          <div class="grid cols-3" style="margin-top:12px">
            <div class="card">
              <h3 style="margin:0">Consultar estado del envío</h3>
              <p class="small" style="margin-top:8px">Introduce tu número de pedido en el seguimiento (funcionalidad pendiente; será integrada con APIs de mensajería).</p>
            </div>
            <div class="card">
              <h3 style="margin:0">Devoluciones</h3>
              <p class="small" style="margin-top:8px">Aceptamos devoluciones en 30 días. Solicítalas desde el detalle de tu pedido y sigue las instrucciones.</p>
            </div>
            <div class="card">
              <h3 style="margin:0">Opciones de pago</h3>
              <p class="small" style="margin-top:8px">El pago en esta demo se simula vía Shopify. Una vez conectes tu tienda Shopify, se ofrecerán tarjeta, PayPal u otros según tu configuración.</p>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <h3 style="margin:0">Informar de un problema</h3>
            <p class="small" style="margin-top:8px">Si tienes un problema con un pedido, producto o pago, rellena el siguiente formulario:</p>
            <form onsubmit="event.preventDefault(); submitIssue()">
              <textarea id="issue-text" placeholder="Describe el problema..." style="min-height:80px;margin-top:8px"></textarea>
              <div style="margin-top:8px;display:flex;gap:8px;justify-content:flex-end">
                <button class="btn-ghost" type="button" onclick="document.getElementById('issue-text').value=''">Limpiar</button>
                <button class="btn" type="submit">Enviar informe</button>
              </div>
            </form>
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
    }
    function submitIssue(){
      const text = $('#issue-text').value.trim();
      if(!text) { alert('Describe el problema antes de enviar.'); return; }
      // here you'd send to backend; in demo we alert
      alert('Informe recibido: ' + text);
      $('#issue-text').value = '';
    }

    // ===== About / Company =====
    function renderAbout(){
      const html = `
        <section>
          <h2>Empresa</h2>
          <div class="grid cols-2" style="margin-top:12px">
            <div class="card">
              <h3 style="margin:0">Novedades</h3>
              <p class="small" style="margin-top:8px">Publica aquí lanzamientos, colaboraciones y descuentos.</p>
            </div>
            <div class="card">
              <h3 style="margin:0">Sostenibilidad</h3>
              <p class="small" style="margin-top:8px">Compromiso con materiales reciclados, procesos sostenibles y transparencia en proveedores.</p>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <h3 style="margin:0">Informar un problema</h3>
            <p class="small" style="margin-top:8px">Si detectas un problema en la web o con un pedido, pulsa el botón y describe el problema.</p>
            <div style="margin-top:8px"><button class="btn" onclick="reportFromAbout()">Reportar problema</button></div>
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
    }
    function reportFromAbout(){
      const detail = prompt('Describe el problema:');
      if(detail) alert('Informe recibido: ' + detail);
    }

    // ===== Favorites view =====
    function renderFavorites(){
      const html = `
        <section>
          <h2>Favoritos</h2>
          <div style="margin-top:12px" class="grid cols-3">
            ${FAVS.length === 0 ? '<div class="card">No tienes favoritos aún.</div>' : FAVS.map(f => `
              <div class="card">
                <img src="${f.img}" style="width:100%;height:200px;object-fit:cover;border-radius:6px" />
                <div style="margin-top:8px">
                  <strong>${escapeHtml(f.name)}</strong>
                  <div class="muted">€${f.price.toFixed(2)}</div>
                  <div style="margin-top:8px;display:flex;gap:8px">
                    <button class="btn" onclick="viewProduct('${f.id || ''}')">Ver</button>
                    <button class="btn-ghost" onclick="removeFav('${f.id}')">Quitar</button>
                  </div>
                </div>
              </div>
            `).join('')}
          </div>
        </section>
      `;
      $('#app').innerHTML = html;
    }
    function removeFav(id){
      const idx = FAVS.findIndex(f=>f.id===id);
      if(idx>=0){
        FAVS.splice(idx,1); persistFavs(); renderFavorites(); renderCounts();
      }
    }

    // ===== Utilities =====
    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // ===== Persistence update on unload =====
    window.addEventListener('beforeunload', ()=>{ persistCart(); persistFavs(); });

    // ===== Expose some functions to global for inline handlers =====
    window.go = go;
    window.viewProduct = viewProduct;
    window.addToCartById = addToCartById;
    window.addFavoriteById = addFavoriteById;
    window.buyNow = buyNow;
    window.updateQty = updateQty;
    window.removeFromCart = removeFromCart;
    window.reportFromAbout = reportFromAbout;
    window.filterCatalog = filterCatalog;
    window.filterSub = filterSub;
    window.processPayment = processPayment;
    window.tryAccess = tryAccess;

    // on load, show home if access exists
    if(sessionStorage.getItem(KEY_ACCESS) === 'granted') go('home');

  </script>
</body>
</html>
